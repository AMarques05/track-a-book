<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Book - Track-A-Book</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="page-container">
        <h1>‚ûï Add New Book</h1>
        
        <h2>üîç Search for Books</h2>
        <div style="border: 1px solid #ccc; padding: 15px; margin: 10px 0;">
            <h3>Google Books Search:</h3>
            
            <label for="searchTerm">Search Term:</label>
            <input type="text" id="searchTerm" placeholder="Enter book title, author, or ISBN">
            
            <label for="condition">Search By:</label>
            <select id="condition">
                <option value="intitle">Title</option>
                <option value="inauthor">Author</option>
                <option value="isbn">ISBN</option>
            </select>
            
            <button onclick="searchBooks()" class="btn btn-primary">üîç Search Books</button>
            
            <div id="searchResults" style="margin-top: 20px;"></div>
        </div>
        
        <hr>
        <p>
            <a href="/books">
                <button class="btn btn-secondary">‚Üê Back to My Books</button>
            </a>
        </p>
    </div>

    <script>
        async function searchBooks() {
            const searchTerm = document.getElementById('searchTerm').value;
            const condition = document.getElementById('condition').value;
            const resultsDiv = document.getElementById('searchResults');
            
            if (!searchTerm) {
                alert('Please enter a search term');
                return;
            }
            
            resultsDiv.innerHTML = '<p>Searching...</p>';
            
            try {
                const response = await fetch('/books/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `searchTerm=${encodeURIComponent(searchTerm)}&condition=${encodeURIComponent(condition)}`
                });
                
                if (!response.ok) {
                    throw new Error('Search failed');
                }
                
                const books = await response.json();
                
                if (books.length === 0) {
                    resultsDiv.innerHTML = '<p>No books found.</p>';
                    return;
                }
                
                let html = '<h4>Search Results:</h4>';
                books.forEach(book => {
                    html += `
                        <div style="border: 1px solid #ddd; margin: 10px 0; padding: 10px;">
                            <h4>${book.title}</h4>
                            <p><strong>Authors:</strong> ${book.authors.join(', ')}</p>
                            <p><strong>Published:</strong> ${book.publishedDate}</p>
                            ${book.thumbnail ? `<img src="${book.thumbnail}" style="max-width: 80px; height: auto;">` : ''}
                            <br><br>
                            <button onclick="addBookFromSearch('${book.title}', '${book.authors.join(', ')}', '${book.publishedDate}', '${book.thumbnail || ''}', '${book.isbn_10 || ''}', '${book.isbn_13 || ''}')" class="btn btn-primary">
                                ‚ûï Add This Book
                            </button>
                        </div>
                    `;
                });
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = '<p style="color: red;">Error searching for books. Please try again.</p>';
                console.error('Search error:', error);
            }
        }
        
        function addBookFromSearch(title, authors, publishedDate, thumbnail, isbn_10, isbn_13) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/books/new';
            
            const fields = {
                title: title,
                authors: authors,
                publishedDate: publishedDate,
                thumbnail: thumbnail,
                isbn_10: isbn_10,
                isbn_13: isbn_13
            };
            
            for (const [key, value] of Object.entries(fields)) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = value;
                form.appendChild(input);
            }
            
            document.body.appendChild(form);
            form.submit();
        }
    </script>
</body>
</html>
