<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Book - BookNoteVault</title>
</head>
<body>
    <h1>‚ûï Add New Book</h1>
    
    <h2>üîç Search for Books</h2>
    <div style="border: 1px solid #ccc; padding: 15px; margin: 10px 0;">
        <h3>Google Books Search:</h3>
        
        <label for="searchTerm">Search Term:</label><br>
        <input type="text" id="searchTerm" placeholder="Enter book title, author, or ISBN"><br><br>
        
        <label for="condition">Search By:</label><br>
        <select id="condition">
            <option value="intitle">Title</option>
            <option value="inauthor">Author</option>
            <option value="isbn">ISBN</option>
        </select><br><br>
        
        <button onclick="searchBooks()">üîç Search Books</button>
        
        <div id="searchResults" style="margin-top: 20px;"></div>
    </div>
    
    <hr>
    
    <h2>üìù Manual Entry</h2>
    <form action="/books/new" method="POST" style="border: 1px solid #ccc; padding: 15px;">
        <h3>Add Book Manually:</h3>
        
        <label for="title">Title:</label><br>
        <input type="text" id="title" name="title" required><br><br>
        
        <label for="authors">Authors:</label><br>
        <input type="text" id="authors" name="authors" placeholder="e.g., Author Name"><br><br>
        
        <label for="publishedDate">Published Date:</label><br>
        <input type="text" id="publishedDate" name="publishedDate" placeholder="e.g., 2023"><br><br>
        
        <label for="thumbnail">Cover Image URL:</label><br>
        <input type="url" id="thumbnail" name="thumbnail" placeholder="https://..."><br><br>
        
        <label for="isbn_10">ISBN-10:</label><br>
        <input type="text" id="isbn_10" name="isbn_10" placeholder="e.g., 1234567890"><br><br>
        
        <label for="isbn_13">ISBN-13:</label><br>
        <input type="text" id="isbn_13" name="isbn_13" placeholder="e.g., 9781234567890"><br><br>
        
        <button type="submit">‚ûï Add Book</button>
    </form>
    
    <hr>
    <p>
        <a href="/books">
            <button>‚Üê Back to My Books</button>
        </a>
    </p>

    <script>
        async function searchBooks() {
            const searchTerm = document.getElementById('searchTerm').value;
            const condition = document.getElementById('condition').value;
            const resultsDiv = document.getElementById('searchResults');
            
            if (!searchTerm) {
                alert('Please enter a search term');
                return;
            }
            
            resultsDiv.innerHTML = '<p>Searching...</p>';
            
            try {
                const response = await fetch('/books/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `searchTerm=${encodeURIComponent(searchTerm)}&condition=${encodeURIComponent(condition)}`
                });
                
                if (!response.ok) {
                    throw new Error('Search failed');
                }
                
                const books = await response.json();
                
                if (books.length === 0) {
                    resultsDiv.innerHTML = '<p>No books found.</p>';
                    return;
                }
                
                let html = '<h4>Search Results:</h4>';
                books.forEach(book => {
                    html += `
                        <div style="border: 1px solid #ddd; margin: 10px 0; padding: 10px;">
                            <h4>${book.title}</h4>
                            <p><strong>Authors:</strong> ${book.authors.join(', ')}</p>
                            <p><strong>Published:</strong> ${book.publishedDate}</p>
                            ${book.thumbnail ? `<img src="${book.thumbnail}" style="max-width: 80px; height: auto;">` : ''}
                            <br><br>
                            <button onclick="addBookFromSearch('${book.title}', '${book.authors.join(', ')}', '${book.publishedDate}', '${book.thumbnail || ''}', '${book.isbn_10 || ''}', '${book.isbn_13 || ''}')">
                                ‚ûï Add This Book
                            </button>
                        </div>
                    `;
                });
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = '<p style="color: red;">Error searching for books. Please try again.</p>';
                console.error('Search error:', error);
            }
        }
        
        function addBookFromSearch(title, authors, publishedDate, thumbnail, isbn_10, isbn_13) {
            // Create and submit a form with the book data
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/books/new';
            
            const fields = {
                title: title,
                authors: authors,
                publishedDate: publishedDate,
                thumbnail: thumbnail,
                isbn_10: isbn_10,
                isbn_13: isbn_13
            };
            
            for (const [key, value] of Object.entries(fields)) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = value;
                form.appendChild(input);
            }
            
            document.body.appendChild(form);
            form.submit();
        }
    </script>
</body>
</html>
